# Milestone v1.0: MVP

**Status:** SHIPPED 2026-02-03
**Phases:** 1-5
**Total Plans:** 18

## Overview

Delivered a driving smoothness coach that uses smartphone sensors to provide real-time audio feedback, training drivers through the Initial D water cup metaphor. The journey progressed from validating core sensor and audio latency (highest risk), through background execution and session management, to UI polish and algorithm refinement.

## Phases

### Phase 1: Sensor & Audio Foundation

**Goal**: User receives audio feedback within 100ms of driving inputs, using jerk-based smoothness detection
**Depends on**: Nothing (first phase)
**Plans**: 3 plans

Plans:
- [x] 01-01-PLAN.md — Project setup + sensor pipeline (DeviceMotion, filtering, Zustand store)
- [x] 01-02-PLAN.md — Smoothness engine (jerk calculation, risk normalization, rolling window)
- [x] 01-03-PLAN.md — Audio feedback system (pre-loaded buffers, triggers, device verification)

**Details:**
- DeviceMotion.acceleration for gravity-compensated accelerometer
- 2Hz low-pass filter removes road vibration noise
- Zone-based audio trigger (0-0.3, 0.3-0.5, 0.5-0.7, 0.7+)
- expo-av for low-latency audio with preloading
- 2500ms spill cooldown prevents rapid-fire feedback

### Phase 2: Background Execution & Permissions

**Goal**: App detects drives automatically and continues recording with screen off or app backgrounded
**Depends on**: Phase 1
**Plans**: 3 plans

Plans:
- [x] 02-01-PLAN.md — Install packages, configure app.json, create drive types/constants
- [x] 02-02-PLAN.md — Background task registry, LocationManager, PermissionManager, useDriveStore
- [x] 02-03-PLAN.md — Drive state machine, useDriveDetection hook, App integration, device verification

**Details:**
- Auto-start at 15 km/h for 5+ seconds
- Auto-stop after 120s stationary
- DriveStateManager pure state machine
- Background audio via staysActiveInBackground
- Sensors always on, audio gated by isDriving state

### Phase 3: Drive Session Management

**Goal**: Drives are persisted with route data, events, and scores that survive app restarts
**Depends on**: Phase 2
**Plans**: 4 plans

Plans:
- [x] 03-01-PLAN.md — SQLite schema and Drizzle ORM setup (expo-sqlite, migrations, schema)
- [x] 03-02-PLAN.md — Drive session lifecycle and event logging (DriveRecorder, breadcrumbs)
- [x] 03-03-PLAN.md — Score calculation engine (TDD, useDriveHistory hook)
- [x] 03-04-PLAN.md — Wire database initialization to App.tsx (gap closure)

**Details:**
- UUID primary keys for future cross-device sync
- timestamp_ms mode for millisecond precision
- 5-second breadcrumb throttling
- Score: base 100, minus 5/10/15 per low/medium/high severity spill
- Duration bonus +1 per 5 min (max 10), perfect drive bonus +5

### Phase 4: UI & User Experience

**Goal**: User can navigate all app screens and the app runs on both iOS and Android
**Depends on**: Phase 3
**Plans**: 5 plans

Plans:
- [x] 04-01-PLAN.md — Navigation infrastructure with expo-router, theme system, tab navigation
- [x] 04-02-PLAN.md — Home screen (hero button, difficulty selector, recent drive) + Active drive screen (water cup animation, spill counter, streak timer)
- [x] 04-03-PLAN.md — Drive summary screen with map, color-coded polyline, spill markers, stats breakdown
- [x] 04-04-PLAN.md — History screen with filtering/sorting + Settings screen with preferences
- [x] 04-05-PLAN.md — UAT gap closure (icons, layout, navigation, persistence)

**Details:**
- expo-router with tabs layout
- lucide-react-native for tab icons
- useAnimatedSensor for 60fps water animation
- Color-coded route polyline (red/orange/green by proximity to spills)
- Zustand persist middleware for settings and difficulty

### Phase 5: Algorithm Refinement

**Goal**: Smoothness detection adapts to user skill level and forgives road imperfections
**Depends on**: Phase 4
**Plans**: 3 plans

Plans:
- [x] 05-01-PLAN.md — Pothole detection system (Z-axis spike analysis, duration filtering, clustering)
- [x] 05-02-PLAN.md — Master mode ambient audio (reactive soundscape, volume interpolation, spill silence)
- [x] 05-03-PLAN.md — Difficulty-aware feedback integration (wire pothole and ambient to useAudioFeedback)

**Details:**
- Z_THRESHOLD 3.9 m/s^2 (0.4g) for pothole detection
- MAX_POTHOLE_DURATION_MS 200ms distinguishes from speed bumps
- Easy/Experienced forgive potholes with bump sound
- Master mode: potholes count as spills, ambient tension audio, dramatic splash

---

## Milestone Summary

**Key Decisions:**

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| Phone sensors only for v1 | Reduce complexity, OBD-II adds hardware dependency | Good - validated core value |
| Audio-only (no visual CarPlay) | Visual UI adds complexity and safety concerns | Good - deferred to v2 |
| Three difficulty levels | Provides progression path for skill development | Good |
| Pothole forgiveness by difficulty | Master level rewards reading the road | Good |
| 50Hz sensor sampling | Balance between accuracy and battery | Good |
| SQLite for persistence | Simple, reliable, no cloud dependency | Good |
| expo-av over react-native-audio-api | Better Expo compatibility | Good |
| Zone-based audio triggers | Prevents audio spam | Good |
| Pure state machine for drive detection | Testable, no side effects | Good |

**Issues Resolved:**

- react-native-audio-api incompatibility → switched to expo-av
- Single location processing missed state transitions → process ALL locations in batch
- Sensors required manual start → sensors always on, audio gated

**Technical Debt Incurred:**

- 24 human verification items (device testing, audio quality, road conditions)
- Phase 1 missing formal VERIFICATION.md (verified via summaries)
- Placeholder audio assets (functional, need production sounds)
- Audio volume control in Settings shows "Coming Soon"
- Android Maps requires external Google Maps API key configuration

---

*For current project status, see .planning/PROJECT.md*
