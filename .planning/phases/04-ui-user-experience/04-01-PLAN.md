---
phase: 04-ui-user-experience
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app.json
  - app/_layout.tsx
  - app/(tabs)/_layout.tsx
  - app/(tabs)/index.tsx
  - app/(tabs)/history/_layout.tsx
  - app/(tabs)/history/index.tsx
  - app/(tabs)/settings.tsx
  - app/drive/_layout.tsx
  - app/drive/active.tsx
  - app/drive/summary/[id].tsx
  - src/theme/colors.ts
  - src/theme/spacing.ts
  - src/hooks/useTheme.ts
  - src/components/shared/ThemedView.tsx
  - src/components/shared/ThemedText.tsx
  - package.json
autonomous: true

must_haves:
  truths:
    - "App follows device dark/light mode setting"
    - "Tab navigation shows Home, History, Settings"
    - "Navigation between screens works without crashes"
  artifacts:
    - path: "app/_layout.tsx"
      provides: "Root layout with providers"
      contains: "Slot"
    - path: "app/(tabs)/_layout.tsx"
      provides: "Tab bar configuration"
      contains: "Tabs"
    - path: "src/theme/colors.ts"
      provides: "Light and dark color definitions"
      exports: ["Colors"]
    - path: "src/hooks/useTheme.ts"
      provides: "Theme hook for components"
      exports: ["useTheme"]
  key_links:
    - from: "app/_layout.tsx"
      to: "DatabaseProvider"
      via: "wraps Slot"
      pattern: "DatabaseProvider"
    - from: "src/hooks/useTheme.ts"
      to: "useColorScheme"
      via: "react-native hook"
      pattern: "useColorScheme"
---

<objective>
Set up Expo Router navigation infrastructure with system-adaptive theming.

Purpose: Foundation layer that all screens depend on. Converts app from single-file to file-based routing with tabs.
Output: Working navigation skeleton with placeholder screens, dark/light mode support.
</objective>

<execution_context>
@/Users/papanash/.claude/get-shit-done/workflows/execute-plan.md
@/Users/papanash/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-ui-user-experience/04-CONTEXT.md
@.planning/phases/04-ui-user-experience/04-RESEARCH.md
@App.tsx
@package.json
@app.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install navigation dependencies and configure app.json</name>
  <files>
    package.json
    app.json
  </files>
  <action>
Install expo-router and dependencies:
```bash
npx expo install expo-router react-native-safe-area-context react-native-screens @react-native-segmented-control/segmented-control expo-keep-awake react-native-maps
```

Update app.json:
1. Change `userInterfaceStyle` from "light" to "automatic" (critical for dark mode per RESEARCH.md pitfall 4)
2. Add expo-router plugin with scheme
3. Update main entry point

Add to app.json expo section:
```json
{
  "scheme": "watercupcoach",
  "plugins": [
    "expo-router",
    ... existing plugins
  ]
}
```

Create/update metro.config.js if needed for expo-router.

Update package.json main entry to "expo-router/entry".

Note: react-native-reanimated is NOT being added here - it's already in the project from Phase 1 (used by expo-av and sensors).
  </action>
  <verify>
Run `npx expo install --check` to verify dependencies are compatible.
Run `npm ls expo-router` to confirm installation.
Check app.json has userInterfaceStyle: "automatic".
  </verify>
  <done>
Dependencies installed, app.json configured for expo-router and system adaptive theming.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create theme system and shared components</name>
  <files>
    src/theme/colors.ts
    src/theme/spacing.ts
    src/hooks/useTheme.ts
    src/components/shared/ThemedView.tsx
    src/components/shared/ThemedText.tsx
  </files>
  <action>
Create src/theme/colors.ts:
```typescript
export const Colors = {
  light: {
    background: '#ffffff',
    surface: '#f5f5f5',
    text: '#1a1a1a',
    textSecondary: '#666666',
    primary: '#00d4ff',
    danger: '#ff4444',
    success: '#00ff00',
    warning: '#ffaa00',
    border: '#e0e0e0',
  },
  dark: {
    background: '#1a1a2e',
    surface: '#2a2a4e',
    text: '#ffffff',
    textSecondary: '#888888',
    primary: '#00d4ff',
    danger: '#ff4444',
    success: '#00ff00',
    warning: '#ffaa00',
    border: '#3a3a5e',
  },
};
```

Create src/theme/spacing.ts:
```typescript
export const Spacing = {
  xs: 4,
  sm: 8,
  md: 16,
  lg: 24,
  xl: 32,
};

export const BorderRadius = {
  sm: 8,
  md: 12,
  lg: 20,
};
```

Create src/hooks/useTheme.ts:
```typescript
import { useColorScheme } from 'react-native';
import { Colors } from '../theme/colors';

export function useTheme() {
  const colorScheme = useColorScheme() ?? 'light';
  return {
    colors: Colors[colorScheme],
    isDark: colorScheme === 'dark',
  };
}
```

Create ThemedView.tsx and ThemedText.tsx following RESEARCH.md patterns.
ThemedView uses colors.background by default.
ThemedText uses colors.text by default with variant prop for textSecondary.
  </action>
  <verify>
TypeScript compilation: `npx tsc --noEmit`
Files exist: ls src/theme/ src/hooks/useTheme.ts src/components/shared/
  </verify>
  <done>
Theme system created with light/dark colors, spacing constants, useTheme hook, and themed base components.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Expo Router file structure with tab navigation</name>
  <files>
    app/_layout.tsx
    app/(tabs)/_layout.tsx
    app/(tabs)/index.tsx
    app/(tabs)/history/_layout.tsx
    app/(tabs)/history/index.tsx
    app/(tabs)/history/[id].tsx
    app/(tabs)/settings.tsx
    app/drive/_layout.tsx
    app/drive/active.tsx
    app/drive/summary/[id].tsx
    index.ts
  </files>
  <action>
Create app/ directory structure per RESEARCH.md architecture pattern.

app/_layout.tsx (root layout):
- Import DatabaseProvider from existing App.tsx
- Wrap Slot with DatabaseProvider and SafeAreaProvider
- Configure StatusBar for adaptive styling
- Handle splash screen hiding after init

app/(tabs)/_layout.tsx:
- Configure Tabs from expo-router
- Three tabs: Home (index), History, Settings
- Use useTheme for tab bar colors
- Icon: use simple Text emoji for now (Home: house, History: clock, Settings: gear) - can add lucide-react-native later if desired

app/(tabs)/index.tsx (Home placeholder):
- ThemedView with "Home Screen - Coming Soon" text
- This will be replaced in Plan 02

app/(tabs)/history/_layout.tsx:
- Stack navigator for history tab
- Enables drill-down to drive detail

app/(tabs)/history/index.tsx (History list placeholder):
- ThemedView with "History - Coming Soon" text

app/(tabs)/history/[id].tsx (Drive detail - alias to summary):
- Redirect to /drive/summary/[id] or render summary inline

app/(tabs)/settings.tsx (Settings placeholder):
- ThemedView with "Settings - Coming Soon" text

app/drive/_layout.tsx:
- Stack for drive flow (active, summary)
- Modal presentation for active drive

app/drive/active.tsx (Active drive placeholder):
- ThemedView with "Active Drive - Coming Soon" text

app/drive/summary/[id].tsx (Summary placeholder):
- ThemedView with "Drive Summary - Coming Soon" text

Update index.ts at root to use expo-router/entry pattern if not handled by package.json main.

IMPORTANT: Move existing App.tsx content (DatabaseProvider, LoadingScreen, error handling) into app/_layout.tsx. The old App.tsx becomes unnecessary with expo-router.

Keep App.tsx temporarily as a backup but it won't be used.
  </action>
  <verify>
Run `npx expo start` and verify:
1. App loads without crash
2. Tab bar appears with 3 tabs
3. Tapping tabs navigates between placeholder screens
4. Dark mode: Change device to dark mode, app colors should adapt
5. No TypeScript errors: `npx tsc --noEmit`
  </verify>
  <done>
Expo Router navigation working with tabs (Home, History, Settings), placeholder screens, and system-adaptive theming.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npx expo start` launches app successfully
2. Tab navigation between Home, History, Settings works
3. Toggle device dark/light mode - app colors change accordingly
4. Navigate to placeholder screens without crashes
5. `npx tsc --noEmit` passes
</verification>

<success_criteria>
- expo-router installed and configured
- app.json has userInterfaceStyle: "automatic"
- Tab bar shows 3 tabs with correct icons/labels
- Theme hook provides colors based on system setting
- All placeholder screens render with themed backgrounds
- DatabaseProvider initialization still works (from Phase 3)
</success_criteria>

<output>
After completion, create `.planning/phases/04-ui-user-experience/04-01-SUMMARY.md`
</output>
